{% extends "base.html" %}
{% block title %}Clientes{% endblock %}

{% block content %}
<div class="bg-white shadow-lg rounded-lg p-6 mx-auto max-w-7xl">
    <!-- Mantenemos el header igual -->
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
        <h2 class="text-2xl font-bold text-gray-800">Clientes</h2>
        
        <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-4 w-full sm:w-auto">
            <!-- Barra de búsqueda -->
            <div class="relative flex-grow sm:flex-grow-0">
                <input type="text" 
                       id="searchInput" 
                       placeholder="Buscar clientes..." 
                       class="w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                <i data-lucide="search" class="absolute right-3 top-2.5 h-5 w-5 text-gray-400"></i>
            </div>

            <!-- Controles de vista -->
            <div class="flex items-center gap-2">
                <div class="flex bg-gray-100 p-1 rounded-lg">
                    <button id="listViewBtn" 
                            class="flex items-center p-2 rounded-md transition-all"
                            aria-label="Vista Lista">
                        <i data-lucide="layout-list" class="h-5 w-5"></i>
                    </button>
                    <button id="kanbanViewBtn"
                            class="flex items-center p-2 rounded-md transition-all"
                            aria-label="Vista Kanban">
                        <i data-lucide="grid" class="h-5 w-5"></i>
                    </button>
                </div>
                
                <a href="/clients/create" 
                   class="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors">
                    <i data-lucide="plus" class="h-5 w-5"></i>
                    <span>Nuevo Cliente</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Vista Lista con botones modificados -->
    <div id="listView" class="overflow-x-auto">
        <table class="w-full border-collapse">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Token</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-200 bg-white">
                {% for client in clients %}
                <tr class="hover:bg-gray-50 transition-colors">
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ client.id }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ client.name }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-500">{{ client.token }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                                   {% if client.is_active %}
                                   bg-green-100 text-green-800
                                   {% else %}
                                   bg-red-100 text-red-800
                                   {% endif %}">
                            <span class="w-2 h-2 mr-2 rounded-full
                                   {% if client.is_active %}
                                   bg-green-400
                                   {% else %}
                                   bg-red-400
                                   {% endif %}"></span>
                            {{ "Activo" if client.is_active else "Inactivo" }}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <div class="flex items-center justify-end space-x-2">
                            <a href="/clients/{{ client.id }}/edit" 
                               class="p-2 bg-amber-100 text-amber-700 rounded-lg hover:bg-amber-200 transition-colors"
                               title="Editar Cliente">
                                <i data-lucide="pencil" class="h-5 w-5"></i>
                            </a>
                            <button onclick="confirmDelete('{{ client.id }}')"
                                    class="p-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors"
                                    title="Eliminar Cliente">
                                <i data-lucide="trash" class="h-5 w-5"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Vista Kanban con botones modificados -->
    <div id="kanbanView" class="hidden grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mt-6">
        {% for client in clients %}
        <div class="bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md transition-shadow">
            <div class="p-5">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center space-x-3">
                        <div class="flex-shrink-0">
                            <i data-lucide="user" class="h-6 w-6 text-gray-400"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-medium text-gray-900">{{ client.name }}</h3>
                            <p class="text-sm text-gray-500">#{{ client.id }}</p>
                        </div>
                    </div>
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                               {% if client.is_active %}
                               bg-green-100 text-green-800
                               {% else %}
                               bg-red-100 text-red-800
                               {% endif %}">
                        <span class="w-2 h-2 mr-2 rounded-full
                               {% if client.is_active %}
                               bg-green-400
                               {% else %}
                               bg-red-400
                               {% endif %}"></span>
                        {{ "Activo" if client.is_active else "Inactivo" }}
                    </span>
                </div>
                <div class="mt-4">
                    <div class="text-sm text-gray-500">Token</div>
                    <div class="mt-1 font-mono text-sm text-gray-900">{{ client.token }}</div>
                </div>
                <div class="mt-6 flex justify-end space-x-2">
                    <a href="/clients/{{ client.id }}/edit" 
                       class="p-2 bg-amber-100 text-amber-700 rounded-lg hover:bg-amber-200 transition-colors"
                       title="Editar Cliente">
                        <i data-lucide="pencil" class="h-5 w-5"></i>
                    </a>
                    <button onclick="confirmDelete('{{ client.id }}')"
                            class="p-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors"
                            title="Eliminar Cliente">
                        <i data-lucide="trash" class="h-5 w-5"></i>
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<style>
/* Estilos para tooltips */
[title] {
    position: relative;
    cursor: pointer;
}

[title]:hover:after {
    content: attr(title);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    padding: 4px 8px;
    background-color: rgba(0, 0, 0, 0.8);
    color: white;
    font-size: 12px;
    white-space: nowrap;
    border-radius: 4px;
    margin-bottom: 5px;
    z-index: 10;
}
</style>

<script>
// Mantenemos el mismo JavaScript
document.addEventListener('DOMContentLoaded', function() {
    const listView = document.getElementById('listView');
    const kanbanView = document.getElementById('kanbanView');
    const listViewBtn = document.getElementById('listViewBtn');
    const kanbanViewBtn = document.getElementById('kanbanViewBtn');
    const searchInput = document.getElementById('searchInput');

    function updateViewButtons(activeView) {
        if (activeView === 'list') {
            listViewBtn.classList.add('bg-white', 'shadow', 'text-blue-600');
            listViewBtn.classList.remove('text-gray-600');
            kanbanViewBtn.classList.remove('bg-white', 'shadow', 'text-blue-600');
            kanbanViewBtn.classList.add('text-gray-600');
        } else {
            kanbanViewBtn.classList.add('bg-white', 'shadow', 'text-blue-600');
            kanbanViewBtn.classList.remove('text-gray-600');
            listViewBtn.classList.remove('bg-white', 'shadow', 'text-blue-600');
            listViewBtn.classList.add('text-gray-600');
        }
    }

    function switchView(view) {
        if (view === 'list') {
            listView.classList.remove('hidden');
            kanbanView.classList.add('hidden');
        } else {
            kanbanView.classList.remove('hidden');
            listView.classList.add('hidden');
        }
        updateViewButtons(view);
        localStorage.setItem('preferredView', view);
    }

    listViewBtn.addEventListener('click', () => switchView('list'));
    kanbanViewBtn.addEventListener('click', () => switchView('kanban'));

    searchInput.addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase();
        const rows = document.querySelectorAll('tbody tr');
        const cards = document.querySelectorAll('#kanbanView > div');

        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(searchTerm) ? '' : 'none';
        });

        cards.forEach(card => {
            const text = card.textContent.toLowerCase();
            card.style.display = text.includes(searchTerm) ? '' : 'none';
        });
    });

    const preferredView = localStorage.getItem('preferredView') || 'list';
    switchView(preferredView);
});

function confirmDelete(id) {
    if (confirm('¿Estás seguro de que deseas eliminar este cliente?')) {
        console.log('Eliminando cliente:', id);
    }
}
</script>
{% endblock %}